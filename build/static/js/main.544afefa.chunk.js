(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{123:function(e,t,a){"use strict";a.r(t);var c,n=a(1),s=a.n(n),r=a(61),o=a.n(r),l=(a(69),a(22)),i=a(2),j=(a(70),a(20)),u=a.n(j),b=a(29),m=a(9),d=a(6),h=a(124),O=a(19),x=a.n(O),g=a(0),f=Object(n.createContext)(),v=function(e){var t=e.children,a=Object(h.a)(["name"]),c=Object(d.a)(a,2),s=c[0],r=(c[1],Object(n.useState)({isLogin:!1,userID:null,userName:null})),o=Object(d.a)(r,2),l=o[0],i=o[1],j=function(e){i(e)};Object(n.useEffect)((function(){!function(){var e={username:s.username,password:s.password};!function(){var t=Object(b.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x.a.post("/api/login",e).then((function(e){j(e.data)}));case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()()}()}));var m={currentUser:l,changeCurrentUserData:j};return Object(g.jsx)(f.Provider,{value:m,children:t})},p=function(e){var t=e.linesData,a=Object(n.useContext)(f).currentUser;return Object(g.jsx)(n.Fragment,{children:Object(g.jsx)("li",{className:"chat-mess message-".concat(t.author===a.userName?"right":"left"," ").concat(t.start?"start":"").concat(t.end?"end":""," "),children:Object(g.jsxs)("div",{className:"messageinner-ms-".concat(t.id),children:[!t.same_author&&Object(g.jsx)("span",{className:"message-name",children:t.author}),t.author===a.userName&&Object(g.jsx)("span",{className:"message-time",children:t.time}),Object(g.jsx)("span",{className:"message-text",children:t.message}),t.author!==a.userName&&Object(g.jsx)("span",{className:"message-time",children:t.time})]})})})},N=a(62),w=a.n(N),y=a(18),k=function(e){var t=e.sendMessageFunc,a=Object(n.useContext)(f).currentUser,c=Object(n.useState)({message:""}),s=Object(d.a)(c,2),r=s[0],o=s[1];return Object(g.jsx)(n.Fragment,{children:Object(g.jsx)("form",{onSubmit:function(e){if(e.preventDefault(),""!==r.message){var c=Object(m.a)(Object(m.a)({},r),{},{username:a.userName});t(c)}o({message:""})},children:Object(g.jsxs)("div",{className:"row align-items-center",children:[Object(g.jsx)("div",{className:"col",children:Object(g.jsx)("label",{className:"col-form-label float-end",htmlFor:"chatMessage",children:"Tin nh\u1eafn"})}),Object(g.jsx)("div",{className:"col-6 col-md-7",children:a.isLogin?Object(g.jsx)("input",{type:"text",id:"chatMessage",value:r.message,className:"form-control",placeholder:"Nh\u1eadp tin nh\u1eafn d\xf4",name:"message",required:!0,onChange:function(e){o(Object(y.a)({},e.target.name,e.target.value))}}):Object(g.jsx)("input",{type:"text",className:"form-control",placeholder:"\u0110\u0103ng nh\u1eadp \u0111\u1ec3 chat",disabled:!0})}),Object(g.jsx)("div",{className:"col",children:a.isLogin&&Object(g.jsx)("button",{className:"btn btn-primary col float-start",children:"G\u1eedi"})})]})})})},S="localhost:4000",C=function(){var e=Object(n.useContext)(f).currentUser;Object(n.useEffect)((function(){c=w()(S,{transports:["websocket"]})}),[S]);var t=Object(n.useState)([]),a=Object(d.a)(t,2),s=a[0],r=a[1],o=Object(n.useState)(25),l=Object(d.a)(o,2),i=l[0],j=(l[1],function(){document.querySelector(".chat-messagne-list").scrollIntoView({behavior:"smooth",block:"end"})}),h=function(e){if(1===e.length)e[0]=Object(m.a)(Object(m.a)({},e[0]),{},{start:!0,end:!0});else if(e.length>1){e[0]=Object(m.a)(Object(m.a)({},e[0]),{},{start:!0});for(var t=1;t<e.length-1;t++)e[t].author==e[t-1].author?e[t].same_author=!0:(e[t].same_author=!1,e[t].start=!0),e[t].author!==e[t+1].author?e[t].end=!0:e[t].end=!1;e[e.length-1].author==e[e.length-2].author?e[e.length-1].same_author=!0:(e[e.length-1].same_author=!1,e[e.length-1].start=!0),e[e.length-1].end=!0}return e},O=function(){var e=Object(b.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.a.post("/api/get_message",{number:t}).then((function(e){var t=e.data.messages;r(h(t))}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Object(n.useEffect)((function(){O(i),setTimeout((function(){j()}),500)}),[]),Object(n.useEffect)((function(){c.on("received_message",(function(){O(i);var e=document.querySelector(".chat-container").scrollTop;document.querySelector(".chat-container").scrollHeight-document.querySelector(".chat-container").offsetHeight-e<100&&j()}))}),[]);return Object(g.jsxs)(n.Fragment,{children:[Object(g.jsxs)("h1",{children:["Chatbox","".concat(e.isLogin?" [".concat(e.userName,"]"):"")]}),Object(g.jsx)("hr",{}),Object(g.jsx)("div",{id:"wrapper",children:Object(g.jsx)("div",{className:"chat",children:Object(g.jsx)("div",{className:"chat-container",children:Object(g.jsx)("div",{className:"chat-listcontainer",children:Object(g.jsx)("ul",{className:"chat-messagne-list",onScroll:function(){var e=document.querySelector(".chat-container").scrollTop,t=(document.querySelector(".chat-container").scrollHeight-document.querySelector(".chat-container").offsetHeight)/e;console.log(t)},children:s?s.map((function(e,t){return Object(g.jsx)(p,{linesData:e},t)})):"Loading..."})})})})}),Object(g.jsx)(k,{sendMessageFunc:function(e){c.emit("send_message",e),O(i),j()}})]})},F=function(){var e=Object(n.useContext)(f),t=e.currentUser,a=e.changeCurrentUserData,c=Object(h.a)(["name"]),s=Object(d.a)(c,2),r=(s[0],s[1]),o=Object(i.f)();t.isLogin&&o.push("/");var l=Object(n.useState)(),j=Object(d.a)(l,2),u=j[0],b=j[1],O=function(e){b(Object(m.a)(Object(m.a)({},u),{},Object(y.a)({},e.target.name,e.target.value)))};return Object(g.jsxs)(n.Fragment,{children:[Object(g.jsx)("h1",{children:"\u0110\u0103ng nh\u1eadp"}),Object(g.jsx)("hr",{}),Object(g.jsx)("form",{onSubmit:function(e){e.preventDefault(),x.a.post("/api/login",u).then((function(e){a(e.data),e.data.isLogin&&(r("username",u.username),r("password",u.password),o.goBack())}))},children:Object(g.jsxs)("div",{className:"container",children:[Object(g.jsxs)("div",{className:"row mb-3",children:[Object(g.jsx)("div",{className:"col"}),Object(g.jsxs)("div",{className:"col-md-5 col-sm-auto",children:[Object(g.jsx)("label",{htmlFor:"username",className:"form-label",children:"T\xe0i kho\u1ea3n"}),Object(g.jsx)("input",{type:"text",name:"username",className:"form-control",placeholder:"\xc9k",required:!0,onChange:O})]}),Object(g.jsx)("div",{className:"col"})]}),Object(g.jsxs)("div",{className:"row mb-3",children:[Object(g.jsx)("div",{className:"col"}),Object(g.jsxs)("div",{className:"col-md-5 col-sm-auto",children:[Object(g.jsx)("label",{htmlFor:"password",className:"form-label",children:"M\u1eadt kh\u1ea9u"}),Object(g.jsx)("input",{type:"password",name:"password",className:"form-control",placeholder:"\u01af \u01b0",onChange:O}),Object(g.jsx)("div",{className:"invalid-feedback",children:"T\xe0i kho\u1ea3n ho\u1eb7c m\u1eadt kh\u1ea9u sai"})]}),Object(g.jsx)("div",{className:"col"})]}),Object(g.jsxs)("div",{className:"row mb-3",children:[Object(g.jsx)("div",{className:"col"}),Object(g.jsx)("div",{className:"col-md-5 col-sm-12",children:Object(g.jsx)("button",{className:"btn btn-primary float-end",type:"submit",children:"\u0110\u0103ng nh\u1eadp"})}),Object(g.jsx)("div",{className:"col"})]})]})})]})},q=function(){var e=Object(n.useContext)(f),t=e.currentUser,a=e.changeCurrentUserData,c=Object(h.a)(["cookie-name"]),s=Object(d.a)(c,3),r=(s[0],s[1],s[2]),o=Object(i.f)();return Object(g.jsx)(n.Fragment,{children:Object(g.jsx)("nav",{className:"navbar navbar-expand-lg navbar-dark bg-primary",children:Object(g.jsxs)("div",{className:"container-fluid",children:[Object(g.jsx)(l.b,{className:"navbar-brand",to:"/",children:"Chatbox"}),Object(g.jsx)("button",{className:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarNav","aria-controls":"navbarNav","aria-expanded":"false","aria-label":"Toggle navigation",children:Object(g.jsx)("span",{className:"navbar-toggler-icon"})}),Object(g.jsx)("div",{className:"collapse navbar-collapse justify-content-end",id:"navbarNav",children:Object(g.jsx)("div",{className:"navbar-nav",children:t.isLogin?Object(g.jsxs)("a",{className:"nav-link",style:{cursor:"pointer"},onClick:function(){a({isLogin:!1}),r("username"),r("password"),o.push("/")},children:["Tho\xe1t [",t.userName,"]"]}):Object(g.jsxs)(n.Fragment,{children:[Object(g.jsx)(l.b,{className:"nav-link",to:"/login",children:"\u0110\u0103ng Nh\u1eadp"}),Object(g.jsx)(l.b,{className:"nav-link",to:"/register",children:"\u0110\u0103ng k\xfd"})]})})})]})})})},L=function(){return Object(g.jsx)(v,{children:Object(g.jsx)(n.Fragment,{children:Object(g.jsxs)(l.a,{children:[Object(g.jsx)(q,{}),Object(g.jsx)("div",{className:"container mt-5",children:Object(g.jsx)("div",{className:"row mt-5",children:Object(g.jsxs)(i.c,{children:[Object(g.jsx)(i.a,{exact:!0,path:"/",component:C}),Object(g.jsx)(i.a,{exact:!0,path:"/login",component:F})]})})})]})})})};o.a.render(Object(g.jsx)(s.a.StrictMode,{children:Object(g.jsx)(L,{})}),document.getElementById("root"))},69:function(e,t,a){},70:function(e,t,a){}},[[123,1,2]]]);
//# sourceMappingURL=main.544afefa.chunk.js.map